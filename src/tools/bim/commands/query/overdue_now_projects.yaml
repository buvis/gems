source:
  directory: ~/bim

filter:
  and:
    - type: {eq: project}
    - completed: {eq: false}
    - expr: |
        from datetime import date
        today = date.today()
        open_now = [t for t in (tasks or []) if t.gtd_list == "now"]
        result = open_now and any(
            (t.due_date and t.due_date < today)
            or (t.start_date and t.start_date < today)
            or (t.reminder_date and t.reminder_date < today)
            for t in open_now
        )

expand:
  field: tasks
  as: task
  filter: "task.gtd_list == 'now'"

columns:
  - field: id
  - field: title
  - expr: "task.action or ''"
    label: next_action
  - expr: "str(task.due_date or '')"
    label: due
  - expr: "str(task.start_date or '')"
    label: start
  - expr: "str(task.reminder_date or '')"
    label: reminder
