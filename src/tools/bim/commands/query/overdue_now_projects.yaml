source:
  directory: ~/bim

filter:
  and:
    - type: {eq: project}
    - completed: {eq: false}
    - expr: |
        from datetime import date
        today = date.today()
        result = any(
            (t.due_date and t.due_date < today)
            or (t.start_date and t.start_date < today)
            or (t.reminder_date and t.reminder_date < today)
            for t in (tasks or [])
        )

expand:
  field: tasks
  as: task
  filter: |
    from datetime import date
    today = date.today()
    result = (
        (task.due_date and task.due_date < today)
        or (task.start_date and task.start_date < today)
        or (task.reminder_date and task.reminder_date < today)
    )

sort:
  - field: due_date
    order: asc

columns:
  - field: title
  - expr: "task.action or ''"
    label: next_action
  - expr: "str(task.due_date) if task.due_date else ''"
    label: due_date
  - expr: "str(task.reminder_date) if task.reminder_date else ''"
    label: scheduled
  - field: file_path

actions:
  - name: delete
    label: Delete
    handler: delete
    confirm: "Permanently delete this note?"
  - name: format
    label: Format
    handler: format
  - name: open
    label: Open
    handler: open
