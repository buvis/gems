

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuration &mdash; buvis-gems  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Formatting" href="formatting.html" />
    <link rel="prev" title="buvis-gems Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            buvis-gems
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Library:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#source-mapping">Source Mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-custom-cli-options">Adding Custom CLI Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tool-specific-configuration-files">Tool-Specific Configuration Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#downstream-project-integration">Downstream Project Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-define-settings">Step 1: Define Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-wire-cli">Step 2: Wire CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-configure-any-combination">Step 3: Configure (any combination)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-abbreviations-from-config">Example: Abbreviations from Config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#yaml-configuration">YAML Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-locations">File Locations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-format">File Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-variable-substitution">Environment Variable Substitution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-settings-classes">Custom Settings Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#globalsettings-vs-toolsettings">GlobalSettings vs ToolSettings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#composing-settings">Composing Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-configresolver-directly">Using ConfigResolver Directly</a></li>
<li class="toctree-l2"><a class="reference internal" href="#security-considerations">Security Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sensitive-fields">Sensitive Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#json-size-limits">JSON Size Limits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testing-code-that-uses-settings">Testing Code That Uses Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mocking-get-settings-in-click-commands">Mocking get_settings in Click Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-with-environment-variables">Testing with Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#missing-environment-variables">Missing Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#yaml-not-loading">YAML Not Loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#precedence-confusion">Precedence Confusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#api-reference">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#core-classes">Core Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#globalsettings">GlobalSettings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buvis.pybase.configuration.GlobalSettings"><code class="docutils literal notranslate"><span class="pre">GlobalSettings</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#toolsettings">ToolSettings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buvis.pybase.configuration.ToolSettings"><code class="docutils literal notranslate"><span class="pre">ToolSettings</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configresolver">ConfigResolver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buvis.pybase.configuration.ConfigResolver"><code class="docutils literal notranslate"><span class="pre">ConfigResolver</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configsource">ConfigSource</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buvis.pybase.configuration.ConfigSource"><code class="docutils literal notranslate"><span class="pre">ConfigSource</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mixins">Mixins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#safeloggingmixin">SafeLoggingMixin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buvis.pybase.configuration.SafeLoggingMixin"><code class="docutils literal notranslate"><span class="pre">SafeLoggingMixin</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#securesettingsmixin">SecureSettingsMixin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buvis.pybase.configuration.SecureSettingsMixin"><code class="docutils literal notranslate"><span class="pre">SecureSettingsMixin</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#click-integration">Click Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.buvis_options"><code class="docutils literal notranslate"><span class="pre">buvis_options()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.get_settings"><code class="docutils literal notranslate"><span class="pre">get_settings()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exceptions">Exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.ConfigurationError"><code class="docutils literal notranslate"><span class="pre">ConfigurationError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.ConfigurationKeyNotFoundError"><code class="docutils literal notranslate"><span class="pre">ConfigurationKeyNotFoundError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.MissingEnvVarError"><code class="docutils literal notranslate"><span class="pre">MissingEnvVarError</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buvis.pybase.configuration.MissingEnvVarError.var_names"><code class="docutils literal notranslate"><span class="pre">MissingEnvVarError.var_names</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#validators">Validators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.validate_nesting_depth"><code class="docutils literal notranslate"><span class="pre">validate_nesting_depth()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.validate_json_env_size"><code class="docutils literal notranslate"><span class="pre">validate_json_env_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.get_model_depth"><code class="docutils literal notranslate"><span class="pre">get_model_depth()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.is_sensitive_field"><code class="docutils literal notranslate"><span class="pre">is_sensitive_field()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#constants">Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.MAX_NESTING_DEPTH"><code class="docutils literal notranslate"><span class="pre">MAX_NESTING_DEPTH</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#buvis.pybase.configuration.MAX_JSON_ENV_SIZE"><code class="docutils literal notranslate"><span class="pre">MAX_JSON_ENV_SIZE</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="formatting.html">Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="filesystem.html">Filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="adapters.html">Adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="zettel.html">Zettel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CLI Tools:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools.html">CLI Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">buvis-gems</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Configuration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/configuration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h1>
<p>This module provides unified configuration management for BUVIS tools with
automatic precedence handling across multiple sources.</p>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#source-mapping" id="id3">Source Mapping</a></p></li>
<li><p><a class="reference internal" href="#adding-custom-cli-options" id="id4">Adding Custom CLI Options</a></p></li>
<li><p><a class="reference internal" href="#tool-specific-configuration-files" id="id5">Tool-Specific Configuration Files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#quick-start" id="id6">Quick Start</a></p></li>
<li><p><a class="reference internal" href="#downstream-project-integration" id="id7">Downstream Project Integration</a></p>
<ul>
<li><p><a class="reference internal" href="#step-1-define-settings" id="id8">Step 1: Define Settings</a></p></li>
<li><p><a class="reference internal" href="#step-2-wire-cli" id="id9">Step 2: Wire CLI</a></p></li>
<li><p><a class="reference internal" href="#step-3-configure-any-combination" id="id10">Step 3: Configure (any combination)</a></p></li>
<li><p><a class="reference internal" href="#example-abbreviations-from-config" id="id11">Example: Abbreviations from Config</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#yaml-configuration" id="id12">YAML Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#file-locations" id="id13">File Locations</a></p></li>
<li><p><a class="reference internal" href="#file-format" id="id14">File Format</a></p></li>
<li><p><a class="reference internal" href="#environment-variable-substitution" id="id15">Environment Variable Substitution</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#environment-variables" id="id16">Environment Variables</a></p></li>
<li><p><a class="reference internal" href="#custom-settings-classes" id="id17">Custom Settings Classes</a></p>
<ul>
<li><p><a class="reference internal" href="#globalsettings-vs-toolsettings" id="id18">GlobalSettings vs ToolSettings</a></p></li>
<li><p><a class="reference internal" href="#composing-settings" id="id19">Composing Settings</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-configresolver-directly" id="id20">Using ConfigResolver Directly</a></p></li>
<li><p><a class="reference internal" href="#security-considerations" id="id21">Security Considerations</a></p>
<ul>
<li><p><a class="reference internal" href="#sensitive-fields" id="id22">Sensitive Fields</a></p></li>
<li><p><a class="reference internal" href="#json-size-limits" id="id23">JSON Size Limits</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#error-handling" id="id24">Error Handling</a></p></li>
<li><p><a class="reference internal" href="#testing" id="id25">Testing</a></p>
<ul>
<li><p><a class="reference internal" href="#testing-code-that-uses-settings" id="id26">Testing Code That Uses Settings</a></p></li>
<li><p><a class="reference internal" href="#mocking-get-settings-in-click-commands" id="id27">Mocking get_settings in Click Commands</a></p></li>
<li><p><a class="reference internal" href="#testing-with-environment-variables" id="id28">Testing with Environment Variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#troubleshooting" id="id29">Troubleshooting</a></p>
<ul>
<li><p><a class="reference internal" href="#missing-environment-variables" id="id30">Missing Environment Variables</a></p></li>
<li><p><a class="reference internal" href="#yaml-not-loading" id="id31">YAML Not Loading</a></p></li>
<li><p><a class="reference internal" href="#precedence-confusion" id="id32">Precedence Confusion</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The configuration system loads settings from multiple sources with clear
precedence rules:</p>
<ol class="arabic simple">
<li><p><strong>CLI arguments</strong> (highest priority)</p></li>
<li><p><strong>Environment variables</strong> (<code class="docutils literal notranslate"><span class="pre">BUVIS_*</span></code> prefix)</p></li>
<li><p><strong>YAML config files</strong> (auto-discovered)</p></li>
<li><p><strong>Model defaults</strong> (lowest priority)</p></li>
</ol>
<p>This means a <code class="docutils literal notranslate"><span class="pre">--debug</span></code> flag always wins over <code class="docutils literal notranslate"><span class="pre">BUVIS_DEBUG=false</span></code> in the
environment, which wins over <code class="docutils literal notranslate"><span class="pre">debug:</span> <span class="pre">false</span></code> in a YAML file.</p>
<section id="source-mapping">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Source Mapping</a><a class="headerlink" href="#source-mapping" title="Link to this heading"></a></h3>
<p>Each Python field maps to CLI, ENV, and YAML sources with consistent naming:</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Mapping Example for <code class="docutils literal notranslate"><span class="pre">PhotoSettings</span></code></span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Python Field</p></th>
<th class="head"><p>CLI Argument</p></th>
<th class="head"><p>Environment Variable</p></th>
<th class="head"><p>YAML Path</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">debug</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--debug</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO_DEBUG</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">photo.debug</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log_level</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--log-level</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO_LOG_LEVEL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">photo.log_level</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">library_path</span></code></p></td>
<td><p>(custom option)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO_LIBRARY_PATH</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">photo.library_path</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">db.host</span></code> (nested)</p></td>
<td><p>(custom option)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO__DB__HOST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">photo.db.host</span></code></p></td>
</tr>
</tbody>
</table>
<p><strong>Naming rules:</strong></p>
<ul class="simple">
<li><p><strong>CLI</strong>: Built-in options (<code class="docutils literal notranslate"><span class="pre">--debug</span></code>, <code class="docutils literal notranslate"><span class="pre">--log-level</span></code>) are added automatically. Custom fields require explicit Click options - see <a class="reference internal" href="#adding-custom-cli-options">Adding Custom CLI Options</a> below.</p></li>
<li><p><strong>ENV</strong>: Prefix from <code class="docutils literal notranslate"><span class="pre">env_prefix</span></code> + field name in SCREAMING_SNAKE_CASE. Nested fields use <code class="docutils literal notranslate"><span class="pre">__</span></code> delimiter.</p></li>
<li><p><strong>YAML</strong>: Tool name (derived from prefix) as root key, then field names with <code class="docutils literal notranslate"><span class="pre">.</span></code> for nesting.</p></li>
</ul>
</section>
<section id="adding-custom-cli-options">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Adding Custom CLI Options</a><a class="headerlink" href="#adding-custom-cli-options" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;buvis_options</span></code> decorator only adds <code class="docutils literal notranslate"><span class="pre">--debug</span></code>, <code class="docutils literal notranslate"><span class="pre">--log-level</span></code>,
<code class="docutils literal notranslate"><span class="pre">--config-dir</span></code>, and <code class="docutils literal notranslate"><span class="pre">--config</span></code>. For custom fields, add your own Click
options and pass them to <code class="docutils literal notranslate"><span class="pre">cli_overrides</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">click</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigResolver</span><span class="p">,</span> <span class="n">GlobalSettings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SettingsConfigDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PhotoSettings</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;BUVIS_PHOTO_&quot;</span><span class="p">)</span>
    <span class="n">library_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Pictures&quot;</span>
    <span class="n">quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">85</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--library&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Photo library path&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--quality&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;JPEG quality (1-100)&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--debug/--no-debug&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">library</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cli_overrides</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s2">&quot;library_path&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">library</span><span class="p">)</span> <span class="k">if</span> <span class="n">library</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="n">quality</span><span class="p">,</span>
            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="n">debug</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">}</span>

    <span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">PhotoSettings</span><span class="p">,</span> <span class="n">cli_overrides</span><span class="o">=</span><span class="n">cli_overrides</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Library: </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">library_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For nested fields (e.g., <code class="docutils literal notranslate"><span class="pre">db.host</span></code>), flatten them in cli_overrides:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nested settings don&#39;t have direct CLI support in cli_overrides.</span>
<span class="c1"># Use ENV vars or YAML for nested fields, or restructure as top-level.</span>
</pre></div>
</div>
</section>
<section id="tool-specific-configuration-files">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Tool-Specific Configuration Files</a><a class="headerlink" href="#tool-specific-configuration-files" title="Link to this heading"></a></h3>
<p>You can separate tool configuration from global settings using dedicated files.
The loader searches for both <code class="docutils literal notranslate"><span class="pre">buvis.yaml</span></code> AND <code class="docutils literal notranslate"><span class="pre">buvis-{tool}.yaml</span></code>:</p>
<p><strong>Option 1: Section in global file</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ~/.config/buvis/buvis.yaml</span>
<span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">log_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>

<span class="nt">photo</span><span class="p">:</span><span class="w">                    </span><span class="c1"># Tool section (from BUVIS_PHOTO_ prefix)</span>
<span class="w">  </span><span class="nt">library_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/media/photos</span>
<span class="w">  </span><span class="nt">quality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
</pre></div>
</div>
<p><strong>Option 2: Separate tool file</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ~/.config/buvis/buvis-photo.yaml</span>
<span class="nt">library_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/media/photos</span>
<span class="nt">quality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
</pre></div>
</div>
<p>Both are merged. Tool-specific file values override global file values for that tool.</p>
<p>The tool name is derived from <code class="docutils literal notranslate"><span class="pre">env_prefix</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO_</span></code> → searches for <code class="docutils literal notranslate"><span class="pre">buvis-photo.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">photo:</span></code> section</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BUVIS_</span></code> (default) → only <code class="docutils literal notranslate"><span class="pre">buvis.yaml</span></code>, no tool section</p></li>
</ul>
<p><strong>Complete example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">GlobalSettings</span><span class="p">,</span> <span class="n">ToolSettings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SettingsConfigDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DatabaseSettings</span><span class="p">(</span><span class="n">ToolSettings</span><span class="p">):</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5432</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PhotoSettings</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;BUVIS_PHOTO_&quot;</span><span class="p">,</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s2">&quot;__&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">library_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;Pictures&quot;</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DatabaseSettings</span> <span class="o">=</span> <span class="n">DatabaseSettings</span><span class="p">()</span>
</pre></div>
</div>
<p>All equivalent ways to set <code class="docutils literal notranslate"><span class="pre">db.host</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;prod.db.local&quot;</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Environment variable (note double underscore for nesting)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BUVIS_PHOTO__DB__HOST</span><span class="o">=</span>prod.db.local
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># YAML (~/.config/buvis/buvis.yaml)</span>
<span class="nt">photo</span><span class="p">:</span>
<span class="w">  </span><span class="nt">db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod.db.local</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python default</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DatabaseSettings</span><span class="p">(</span><span class="n">ToolSettings</span><span class="p">):</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prod.db.local&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="quick-start">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Quick Start</a><a class="headerlink" href="#quick-start" title="Link to this heading"></a></h2>
<p>Add configuration to any Click command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">click</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">buvis_options</span><span class="p">,</span> <span class="n">get_settings</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@buvis_options</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Debug mode enabled&quot;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log level: </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">log_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>This adds <code class="docutils literal notranslate"><span class="pre">--debug</span></code>, <code class="docutils literal notranslate"><span class="pre">--log-level</span></code>, <code class="docutils literal notranslate"><span class="pre">--config-dir</span></code>, and <code class="docutils literal notranslate"><span class="pre">--config</span></code>
options. Values resolve from CLI &gt; ENV &gt; YAML &gt; defaults.</p>
<p>For tool-specific settings, see <a class="reference internal" href="#downstream-project-integration">Downstream Project Integration</a> or
<a class="reference internal" href="#custom-settings-classes">Custom Settings Classes</a>.</p>
</section>
<section id="downstream-project-integration">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Downstream Project Integration</a><a class="headerlink" href="#downstream-project-integration" title="Link to this heading"></a></h2>
<p>Step-by-step guide for projects depending on buvis-pybase.</p>
<section id="step-1-define-settings">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Step 1: Define Settings</a><a class="headerlink" href="#step-1-define-settings" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># myproject/settings.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">GlobalSettings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SettingsConfigDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyProjectSettings</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;MYPROJECT_&quot;</span><span class="p">,</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s2">&quot;__&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;.myproject&quot;</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="step-2-wire-cli">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Step 2: Wire CLI</a><a class="headerlink" href="#step-2-wire-cli" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># myproject/cli.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">click</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">buvis_options</span><span class="p">,</span> <span class="n">get_settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myproject.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyProjectSettings</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@buvis_options</span><span class="p">(</span><span class="n">settings_class</span><span class="o">=</span><span class="n">MyProjectSettings</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">click</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">MyProjectSettings</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data dir: </span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-3-configure-any-combination">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Step 3: Configure (any combination)</a><a class="headerlink" href="#step-3-configure-any-combination" title="Link to this heading"></a></h3>
<p>CLI: <code class="docutils literal notranslate"><span class="pre">myproject</span> <span class="pre">--debug</span> <span class="pre">--log-level</span> <span class="pre">DEBUG</span></code></p>
<p>Environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">MYPROJECT_DATA_DIR</span><span class="o">=</span>/var/data
<span class="nb">export</span><span class="w"> </span><span class="nv">MYPROJECT_VERBOSE</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>YAML (<code class="docutils literal notranslate"><span class="pre">~/.config/buvis/buvis.yaml</span></code>):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">myproject</span><span class="p">:</span>
<span class="w">  </span><span class="nt">data_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/data</span>
<span class="w">  </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</section>
<section id="example-abbreviations-from-config">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Example: Abbreviations from Config</a><a class="headerlink" href="#example-abbreviations-from-config" title="Link to this heading"></a></h3>
<p>Load abbreviation definitions from YAML and pass to <code class="docutils literal notranslate"><span class="pre">StringOperator</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">GlobalSettings</span><span class="p">,</span> <span class="n">ToolSettings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.formatting</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringOperator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SettingsConfigDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FormattingSettings</span><span class="p">(</span><span class="n">ToolSettings</span><span class="p">):</span>
    <span class="n">abbreviations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DocSettings</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;DOC_&quot;</span><span class="p">)</span>
    <span class="n">formatting</span><span class="p">:</span> <span class="n">FormattingSettings</span> <span class="o">=</span> <span class="n">FormattingSettings</span><span class="p">()</span>

<span class="c1"># In CLI:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">DocSettings</span><span class="p">)</span>
<span class="n">expanded</span> <span class="o">=</span> <span class="n">StringOperator</span><span class="o">.</span><span class="n">replace_abbreviations</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Use the API&quot;</span><span class="p">,</span>
    <span class="n">abbreviations</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">formatting</span><span class="o">.</span><span class="n">abbreviations</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># -&gt; &quot;Use the Application Programming Interface&quot;</span>
</pre></div>
</div>
<p>YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">doc</span><span class="p">:</span>
<span class="w">  </span><span class="nt">formatting</span><span class="p">:</span>
<span class="w">    </span><span class="nt">abbreviations</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">API</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Application Programming Interface</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">CLI</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Command Line Interface</span>
</pre></div>
</div>
</section>
</section>
<section id="yaml-configuration">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">YAML Configuration</a><a class="headerlink" href="#yaml-configuration" title="Link to this heading"></a></h2>
<section id="file-locations">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">File Locations</a><a class="headerlink" href="#file-locations" title="Link to this heading"></a></h3>
<p>Config files are discovered in order (first found wins):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$BUVIS_CONFIG_DIR/buvis.yaml</span></code> (if env var set)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$XDG_CONFIG_HOME/buvis/buvis.yaml</span></code> (or <code class="docutils literal notranslate"><span class="pre">~/.config/buvis/buvis.yaml</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/.buvis/buvis.yaml</span></code> (legacy)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./buvis.yaml</span></code> (current directory)</p></li>
</ol>
<p>For tool-specific config, files named <code class="docutils literal notranslate"><span class="pre">buvis-{tool}.yaml</span></code> are also checked.</p>
</section>
<section id="file-format">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">File Format</a><a class="headerlink" href="#file-format" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ~/.config/buvis/buvis.yaml</span>
<span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">log_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="nt">output_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text</span>

<span class="c1"># Tool-specific sections</span>
<span class="nt">photo</span><span class="p">:</span>
<span class="w">  </span><span class="nt">watermark</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">default_album</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shared</span>
<span class="nt">music</span><span class="p">:</span>
<span class="w">  </span><span class="nt">normalize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">bitrate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">320</span>
</pre></div>
</div>
</section>
<section id="environment-variable-substitution">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Environment Variable Substitution</a><a class="headerlink" href="#environment-variable-substitution" title="Link to this heading"></a></h3>
<p>YAML files support environment variable interpolation:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_HOST}</span><span class="w">                    </span><span class="c1"># Required - fails if not set</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PORT:-5432}</span><span class="w">              </span><span class="c1"># Optional with default</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
<span class="w">  </span><span class="nt">connection_string</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$${NOT_EXPANDED}</span><span class="w"> </span><span class="c1"># Escaped - becomes literal ${NOT_EXPANDED}</span>
</pre></div>
</div>
<p>Substitution is applied automatically by <code class="docutils literal notranslate"><span class="pre">ConfigResolver</span></code> when it loads YAML:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigResolver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">PhotoSettings</span>

<span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">PhotoSettings</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="environment-variables">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Environment Variables</a><a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">GlobalSettings</span></code> base class uses the <code class="docutils literal notranslate"><span class="pre">BUVIS_</span></code> prefix in
SCREAMING_SNAKE_CASE. Override <code class="docutils literal notranslate"><span class="pre">env_prefix</span></code> on your settings class (as shown
in <code class="docutils literal notranslate"><span class="pre">PhotoSettings</span></code> above) to scope variables per tool:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">BUVIS_PHOTO_DEBUG</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BUVIS_PHOTO_LOG_LEVEL</span><span class="o">=</span>DEBUG
<span class="nb">export</span><span class="w"> </span><span class="nv">BUVIS_PHOTO_OUTPUT_FORMAT</span><span class="o">=</span>json
</pre></div>
</div>
<p>For nested fields, use double underscores:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">BUVIS_PHOTO__MUSIC__NORMALIZE</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BUVIS_PHOTO__MUSIC__BITRATE</span><span class="o">=</span><span class="m">256</span>
</pre></div>
</div>
</section>
<section id="custom-settings-classes">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Custom Settings Classes</a><a class="headerlink" href="#custom-settings-classes" title="Link to this heading"></a></h2>
<section id="globalsettings-vs-toolsettings">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">GlobalSettings vs ToolSettings</a><a class="headerlink" href="#globalsettings-vs-toolsettings" title="Link to this heading"></a></h3>
<p>Use the right base class:</p>
<ul class="simple">
<li><p><strong>GlobalSettings</strong> (<code class="docutils literal notranslate"><span class="pre">pydantic_settings.BaseSettings</span></code>) - For your root settings class. Loads from environment variables automatically using the <code class="docutils literal notranslate"><span class="pre">env_prefix</span></code>.</p></li>
<li><p><strong>ToolSettings</strong> (<code class="docutils literal notranslate"><span class="pre">pydantic.BaseModel</span></code>) - For nested settings within a root class. Does NOT load from env directly; the parent <code class="docutils literal notranslate"><span class="pre">GlobalSettings</span></code> handles env resolution for nested fields.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">GlobalSettings</span><span class="p">,</span> <span class="n">ToolSettings</span>

<span class="c1"># ToolSettings for nested - no env loading, just structure</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DatabaseSettings</span><span class="p">(</span><span class="n">ToolSettings</span><span class="p">):</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5432</span>

<span class="c1"># GlobalSettings for root - loads BUVIS_MYAPP_* from env</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyAppSettings</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;BUVIS_MYAPP_&quot;</span><span class="p">)</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DatabaseSettings</span> <span class="o">=</span> <span class="n">DatabaseSettings</span><span class="p">()</span>  <span class="c1"># Nested</span>

<span class="c1"># Environment variable for nested field:</span>
<span class="c1"># BUVIS_MYAPP__DB__HOST=prod.db.local  (double underscore!)</span>
</pre></div>
</div>
<p><strong>Why this matters</strong>: If you used <code class="docutils literal notranslate"><span class="pre">GlobalSettings</span></code> for nested classes, each would try to load from env independently with potentially conflicting prefixes.</p>
<p>Both classes are <strong>frozen</strong> (immutable) - you cannot modify settings after creation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">MyAppSettings</span><span class="p">)</span>
<span class="n">settings</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>  <span class="c1"># Raises: ValidationError (frozen)</span>
</pre></div>
</div>
</section>
<section id="composing-settings">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Composing Settings</a><a class="headerlink" href="#composing-settings" title="Link to this heading"></a></h3>
<p>Model tool namespaces with <code class="docutils literal notranslate"><span class="pre">ToolSettings</span></code> and compose them into your root
<code class="docutils literal notranslate"><span class="pre">GlobalSettings</span></code> subclass:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">GlobalSettings</span><span class="p">,</span> <span class="n">ToolSettings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SettingsConfigDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MusicSettings</span><span class="p">(</span><span class="n">ToolSettings</span><span class="p">):</span>
    <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bitrate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">320</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PhotoSettings</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;BUVIS_PHOTO_&quot;</span><span class="p">,</span>
        <span class="n">env_nested_delimiter</span><span class="o">=</span><span class="s2">&quot;__&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
    <span class="n">watermark</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">music</span><span class="p">:</span> <span class="n">MusicSettings</span> <span class="o">=</span> <span class="n">MusicSettings</span><span class="p">()</span>
</pre></div>
</div>
<p>Nested environment variables map to these namespaces (for example,
<code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO__RESOLUTION=medium</span></code> or <code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO__MUSIC__BITRATE=256</span></code>).</p>
</section>
</section>
<section id="using-configresolver-directly">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Using ConfigResolver Directly</a><a class="headerlink" href="#using-configresolver-directly" title="Link to this heading"></a></h2>
<p>For non-Click applications or custom resolution:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigResolver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">PhotoSettings</span>

<span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span>
    <span class="n">PhotoSettings</span><span class="p">,</span>
    <span class="n">cli_overrides</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>  <span class="c1"># Simulate CLI args</span>
<span class="p">)</span>

<span class="c1"># Check where each value came from</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resolver</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>  <span class="c1"># {&quot;debug&quot;: ConfigSource.CLI, &quot;log_level&quot;: ConfigSource.DEFAULT}</span>
</pre></div>
</div>
</section>
<section id="security-considerations">
<h2><a class="toc-backref" href="#id21" role="doc-backlink">Security Considerations</a><a class="headerlink" href="#security-considerations" title="Link to this heading"></a></h2>
<section id="sensitive-fields">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Sensitive Fields</a><a class="headerlink" href="#sensitive-fields" title="Link to this heading"></a></h3>
<p>Fields matching patterns like <code class="docutils literal notranslate"><span class="pre">password</span></code>, <code class="docutils literal notranslate"><span class="pre">token</span></code>, <code class="docutils literal notranslate"><span class="pre">api_key</span></code>, <code class="docutils literal notranslate"><span class="pre">secret</span></code>
are automatically:</p>
<ul class="simple">
<li><p>Masked in <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> output (shows <code class="docutils literal notranslate"><span class="pre">***</span></code>)</p></li>
<li><p>Logged at INFO level (vs DEBUG for normal fields)</p></li>
<li><p>Hidden in validation error messages</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">SafeLoggingMixin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecureSettings</span><span class="p">(</span><span class="n">SafeLoggingMixin</span><span class="p">,</span> <span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">SecureSettings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;hunter2&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># SecureSettings(api_key=&#39;***&#39;, password=&#39;***&#39;)</span>
</pre></div>
</div>
</section>
<section id="json-size-limits">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">JSON Size Limits</a><a class="headerlink" href="#json-size-limits" title="Link to this heading"></a></h3>
<p>Environment variables containing JSON are limited to 64KB to prevent DoS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecureSettingsMixin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MySettings</span><span class="p">(</span><span class="n">SecureSettingsMixin</span><span class="p">,</span> <span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;env_prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;MYAPP_&quot;</span><span class="p">}</span>
    <span class="n">complex_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Raises ValueError if MYAPP_COMPLEX_CONFIG exceeds 64KB</span>
</pre></div>
</div>
</section>
</section>
<section id="error-handling">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Error Handling</a><a class="headerlink" href="#error-handling" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConfigResolver</span><span class="p">,</span>
    <span class="n">ConfigurationError</span><span class="p">,</span>
    <span class="n">MissingEnvVarError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">PhotoSettings</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">PhotoSettings</span><span class="p">)</span>
<span class="k">except</span> <span class="n">MissingEnvVarError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required env vars: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">var_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ConfigurationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="testing">
<h2><a class="toc-backref" href="#id25" role="doc-backlink">Testing</a><a class="headerlink" href="#testing" title="Link to this heading"></a></h2>
<section id="testing-code-that-uses-settings">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Testing Code That Uses Settings</a><a class="headerlink" href="#testing-code-that-uses-settings" title="Link to this heading"></a></h3>
<p>For unit tests, create settings directly without the resolver:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyAppSettings</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_with_custom_settings</span><span class="p">():</span>
    <span class="c1"># Create settings with test values directly</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">MyAppSettings</span><span class="p">(</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;test-db&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">5433</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">settings</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="n">settings</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">host</span> <span class="o">==</span> <span class="s2">&quot;test-db&quot;</span>
</pre></div>
</div>
</section>
<section id="mocking-get-settings-in-click-commands">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Mocking get_settings in Click Commands</a><a class="headerlink" href="#mocking-get-settings-in-click-commands" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pytest-mock</span></code> to mock <code class="docutils literal notranslate"><span class="pre">get_settings</span></code> in CLI tests:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">click.testing</span><span class="w"> </span><span class="kn">import</span> <span class="n">CliRunner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyAppSettings</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_settings</span><span class="p">(</span><span class="n">mocker</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">MyAppSettings</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;myapp.cli.get_settings&quot;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">settings</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_cli_with_mocked_settings</span><span class="p">(</span><span class="n">mock_settings</span><span class="p">):</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="testing-with-environment-variables">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">Testing with Environment Variables</a><a class="headerlink" href="#testing-with-environment-variables" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">monkeypatch</span></code> to set env vars for integration tests:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_settings_from_env</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s2">&quot;BUVIS_MYAPP_DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s2">&quot;BUVIS_MYAPP__DB__HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;env-db&quot;</span><span class="p">)</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigResolver</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyAppSettings</span>

    <span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">MyAppSettings</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">settings</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="n">settings</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">host</span> <span class="o">==</span> <span class="s2">&quot;env-db&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2><a class="toc-backref" href="#id29" role="doc-backlink">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="missing-environment-variables">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Missing Environment Variables</a><a class="headerlink" href="#missing-environment-variables" title="Link to this heading"></a></h3>
<p>If YAML uses <code class="docutils literal notranslate"><span class="pre">${VAR}</span></code> without a default, you’ll get <code class="docutils literal notranslate"><span class="pre">MissingEnvVarError</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># buvis.yaml</span>
<span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span><span class="w">  </span><span class="c1"># Fails if not set</span>

<span class="c1"># Fix: provide default</span>
<span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD:-}</span><span class="w">  </span><span class="c1"># Empty string default</span>
</pre></div>
</div>
</section>
<section id="yaml-not-loading">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">YAML Not Loading</a><a class="headerlink" href="#yaml-not-loading" title="Link to this heading"></a></h3>
<p>Check file locations (in order):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$BUVIS_CONFIG_DIR/buvis.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/.config/buvis/buvis.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/.buvis/buvis.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./buvis.yaml</span></code></p></li>
</ol>
<p>Debug with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">buvis.pybase.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigResolver</span>

<span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">MySettings</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resolver</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>  <span class="c1"># Shows where each value came from</span>
</pre></div>
</div>
</section>
<section id="precedence-confusion">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Precedence Confusion</a><a class="headerlink" href="#precedence-confusion" title="Link to this heading"></a></h3>
<p>CLI always wins, then ENV, then YAML, then defaults.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This won&#39;t work as expected:</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BUVIS_DEBUG</span><span class="o">=</span><span class="nb">true</span>
myapp<span class="w"> </span>--no-debug<span class="w">  </span><span class="c1"># CLI wins -&gt; debug=False</span>
</pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading"></a></h1>
<section id="core-classes">
<h2>Core Classes<a class="headerlink" href="#core-classes" title="Link to this heading"></a></h2>
<section id="globalsettings">
<h3>GlobalSettings<a class="headerlink" href="#globalsettings" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="buvis.pybase.configuration.GlobalSettings">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">GlobalSettings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_case_sensitive</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_nested_model_default_partial_update</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DotenvType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">PosixPath('.')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_file_encoding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_ignore_empty</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_nested_delimiter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_nested_max_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_parse_none_str</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_env_parse_enums</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_prog_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_parse_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_settings_source</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CliSettingsSource</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_parse_none_str</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_hide_none_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_avoid_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_enforce_required</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_use_class_docs_for_groups</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_exit_on_error</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_flag_prefix_char</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_implicit_flags</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_ignore_unknown_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_kebab_case</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'all'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'no_enums'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_cli_shortcuts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_secrets_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">PathType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'DEBUG'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'INFO'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'WARNING'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'ERROR'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'CRITICAL'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'INFO'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'text'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'json'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'yaml'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'text'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buvis.pybase.configuration.GlobalSettings" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSettings</span></code></p>
<p>Global runtime settings for BUVIS tools.</p>
<p>Loads from environment variables with <code class="docutils literal notranslate"><span class="pre">BUVIS_</span></code> prefix.
Nested delimiter is <code class="docutils literal notranslate"><span class="pre">__</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">BUVIS_PHOTO__LIBRARY_PATH</span></code>).</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.GlobalSettings.debug">
<span class="sig-name descname"><span class="pre">debug</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></span><a class="headerlink" href="#buvis.pybase.configuration.GlobalSettings.debug" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.GlobalSettings.log_level">
<span class="sig-name descname"><span class="pre">log_level</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'DEBUG'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'INFO'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'WARNING'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'ERROR'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'CRITICAL'</span></span><span class="p"><span class="pre">]</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.GlobalSettings.log_level" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.GlobalSettings.model_config">
<span class="sig-name descname"><span class="pre">model_config</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'arbitrary_types_allowed':</span> <span class="pre">True,</span> <span class="pre">'case_sensitive':</span> <span class="pre">False,</span> <span class="pre">'cli_avoid_json':</span> <span class="pre">False,</span> <span class="pre">'cli_enforce_required':</span> <span class="pre">False,</span> <span class="pre">'cli_exit_on_error':</span> <span class="pre">True,</span> <span class="pre">'cli_flag_prefix_char':</span> <span class="pre">'-',</span> <span class="pre">'cli_hide_none_type':</span> <span class="pre">False,</span> <span class="pre">'cli_ignore_unknown_args':</span> <span class="pre">False,</span> <span class="pre">'cli_implicit_flags':</span> <span class="pre">False,</span> <span class="pre">'cli_kebab_case':</span> <span class="pre">False,</span> <span class="pre">'cli_parse_args':</span> <span class="pre">None,</span> <span class="pre">'cli_parse_none_str':</span> <span class="pre">None,</span> <span class="pre">'cli_prefix':</span> <span class="pre">'',</span> <span class="pre">'cli_prog_name':</span> <span class="pre">None,</span> <span class="pre">'cli_shortcuts':</span> <span class="pre">None,</span> <span class="pre">'cli_use_class_docs_for_groups':</span> <span class="pre">False,</span> <span class="pre">'enable_decoding':</span> <span class="pre">True,</span> <span class="pre">'env_file':</span> <span class="pre">None,</span> <span class="pre">'env_file_encoding':</span> <span class="pre">None,</span> <span class="pre">'env_ignore_empty':</span> <span class="pre">False,</span> <span class="pre">'env_nested_delimiter':</span> <span class="pre">'__',</span> <span class="pre">'env_nested_max_split':</span> <span class="pre">None,</span> <span class="pre">'env_parse_enums':</span> <span class="pre">None,</span> <span class="pre">'env_parse_none_str':</span> <span class="pre">None,</span> <span class="pre">'env_prefix':</span> <span class="pre">'BUVIS_',</span> <span class="pre">'extra':</span> <span class="pre">'forbid',</span> <span class="pre">'frozen':</span> <span class="pre">True,</span> <span class="pre">'json_file':</span> <span class="pre">None,</span> <span class="pre">'json_file_encoding':</span> <span class="pre">None,</span> <span class="pre">'nested_model_default_partial_update':</span> <span class="pre">False,</span> <span class="pre">'protected_namespaces':</span> <span class="pre">('model_validate',</span> <span class="pre">'model_dump',</span> <span class="pre">'settings_customise_sources'),</span> <span class="pre">'secrets_dir':</span> <span class="pre">None,</span> <span class="pre">'toml_file':</span> <span class="pre">None,</span> <span class="pre">'validate_default':</span> <span class="pre">True,</span> <span class="pre">'yaml_config_section':</span> <span class="pre">None,</span> <span class="pre">'yaml_file':</span> <span class="pre">None,</span> <span class="pre">'yaml_file_encoding':</span> <span class="pre">None}</span></span><a class="headerlink" href="#buvis.pybase.configuration.GlobalSettings.model_config" title="Link to this definition"></a></dt>
<dd><p>Configuration for the model, should be a dictionary conforming to [<cite>ConfigDict</cite>][pydantic.config.ConfigDict].</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.GlobalSettings.output_format">
<span class="sig-name descname"><span class="pre">output_format</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'text'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'json'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'yaml'</span></span><span class="p"><span class="pre">]</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.GlobalSettings.output_format" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="toolsettings">
<h3>ToolSettings<a class="headerlink" href="#toolsettings" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ToolSettings">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">ToolSettings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buvis.pybase.configuration.ToolSettings" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseModel</span></code></p>
<p>Base for tool-specific settings.</p>
<p>All tool namespaces inherit from this. Each tool gets enabled: bool = True.
Subclasses add tool-specific fields. Uses BaseModel (not BaseSettings) since
parent GlobalSettings handles ENV resolution.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ToolSettings.enabled">
<span class="sig-name descname"><span class="pre">enabled</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></span><a class="headerlink" href="#buvis.pybase.configuration.ToolSettings.enabled" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ToolSettings.model_config">
<span class="sig-name descname"><span class="pre">model_config</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'extra':</span> <span class="pre">'forbid',</span> <span class="pre">'frozen':</span> <span class="pre">True}</span></span><a class="headerlink" href="#buvis.pybase.configuration.ToolSettings.model_config" title="Link to this definition"></a></dt>
<dd><p>Configuration for the model, should be a dictionary conforming to [<cite>ConfigDict</cite>][pydantic.config.ConfigDict].</p>
</dd></dl>

</dd></dl>

</section>
<section id="configresolver">
<h3>ConfigResolver<a class="headerlink" href="#configresolver" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigResolver">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">ConfigResolver</span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigResolver" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Unified configuration loader with precedence handling.</p>
<p>Orchestrates config loading from multiple sources:</p>
<ul class="simple">
<li><p>YAML files (via ConfigurationLoader discovery)</p></li>
<li><p>Environment variables (via Pydantic, BUVIS_* prefix)</p></li>
<li><p>CLI overrides (passed to resolve())</p></li>
</ul>
<p>Precedence (highest to lowest):</p>
<ol class="arabic simple">
<li><p>CLI overrides</p></li>
<li><p>Environment variables (BUVIS_* prefix)</p></li>
<li><p>YAML config files</p></li>
<li><p>Model defaults</p></li>
</ol>
<p class="rubric">Example</p>
<p>Basic usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">)</span>
</pre></div>
</div>
<p>With CLI overrides from Click:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">debug</span><span class="p">):</span>
    <span class="n">resolver</span> <span class="o">=</span> <span class="n">ConfigResolver</span><span class="p">()</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span>
        <span class="n">GlobalSettings</span><span class="p">,</span>
        <span class="n">cli_overrides</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="n">debug</span><span class="p">}</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Custom config directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">GlobalSettings</span><span class="p">,</span> <span class="n">config_dir</span><span class="o">=</span><span class="s2">&quot;/etc/buvis&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Settings are immutable after resolve(). Instances are frozen. The tool
name is inferred from <code class="docutils literal notranslate"><span class="pre">settings_class.model_config['env_prefix']</span></code>
following the pattern <code class="docutils literal notranslate"><span class="pre">BUVIS_{TOOL}_</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">&quot;tool&quot;</span></code>; you no longer
pass <code class="docutils literal notranslate"><span class="pre">tool_name</span></code> manually.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigResolver.resolve">
<span class="sig-name descname"><span class="pre">resolve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">settings_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cli_overrides</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">T</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigResolver.resolve" title="Link to this definition"></a></dt>
<dd><p>Instantiate a settings class with precedence: CLI &gt; ENV &gt; YAML &gt; Defaults.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>settings_class</strong> – The Pydantic settings class to instantiate.</p></li>
<li><p><strong>config_dir</strong> – Optional configuration directory that overrides
<code class="docutils literal notranslate"><span class="pre">BUVIS_CONFIG_DIR</span></code> environment variable for this resolution.</p></li>
<li><p><strong>config_path</strong> – Optional path to YAML config file.</p></li>
<li><p><strong>cli_overrides</strong> – Explicit overrides typically parsed from CLI options.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An immutable instance of <code class="docutils literal notranslate"><span class="pre">settings_class</span></code> populated with resolved
values. The instance is frozen and cannot be modified after creation.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#buvis.pybase.configuration.ConfigurationError" title="buvis.pybase.configuration.ConfigurationError"><strong>ConfigurationError</strong></a> – If validation fails for any configuration value.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Precedence order (highest to lowest):</p>
<ol class="arabic simple">
<li><p>CLI overrides (explicit values passed in cli_overrides)</p></li>
<li><p>Environment variables (Pydantic handles automatically)</p></li>
<li><p>YAML config file values</p></li>
<li><p>Model field defaults</p></li>
</ol>
<p>Config file discovery uses the tool name derived from
<code class="docutils literal notranslate"><span class="pre">settings_class.model_config['env_prefix']</span></code> (<code class="docutils literal notranslate"><span class="pre">BUVIS_{TOOL}_</span></code> -&gt;
<code class="docutils literal notranslate"><span class="pre">&quot;tool&quot;</span></code>) to locate YAML files.</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigResolver.sources">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">sources</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#buvis.pybase.configuration.ConfigSource" title="buvis.pybase.configuration.source.ConfigSource"><span class="pre">ConfigSource</span></a><span class="p"><span class="pre">]</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigResolver.sources" title="Link to this definition"></a></dt>
<dd><p>Get copy of source tracking dict.</p>
</dd></dl>

</dd></dl>

</section>
<section id="configsource">
<h3>ConfigSource<a class="headerlink" href="#configsource" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigSource">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">ConfigSource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">values</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buvis.pybase.configuration.ConfigSource" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Source from which a configuration value was obtained.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigSource.CLI">
<span class="sig-name descname"><span class="pre">CLI</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'cli'</span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigSource.CLI" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigSource.DEFAULT">
<span class="sig-name descname"><span class="pre">DEFAULT</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'default'</span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigSource.DEFAULT" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigSource.ENV">
<span class="sig-name descname"><span class="pre">ENV</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'env'</span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigSource.ENV" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigSource.YAML">
<span class="sig-name descname"><span class="pre">YAML</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'yaml'</span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigSource.YAML" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
</section>
<section id="mixins">
<h2>Mixins<a class="headerlink" href="#mixins" title="Link to this heading"></a></h2>
<section id="safeloggingmixin">
<h3>SafeLoggingMixin<a class="headerlink" href="#safeloggingmixin" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="buvis.pybase.configuration.SafeLoggingMixin">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">SafeLoggingMixin</span></span><a class="headerlink" href="#buvis.pybase.configuration.SafeLoggingMixin" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Mixin that sanitizes sensitive values in __repr__.</p>
<p>Per PRD: “Sanitize before logging: Don’t log raw JSON (may contain secrets)”</p>
<p>Masks values for fields whose names match sensitive patterns like
‘api_key’, ‘password’, ‘token’, ‘authorization’, etc.</p>
</dd></dl>

</section>
<section id="securesettingsmixin">
<h3>SecureSettingsMixin<a class="headerlink" href="#securesettingsmixin" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="buvis.pybase.configuration.SecureSettingsMixin">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">SecureSettingsMixin</span></span><a class="headerlink" href="#buvis.pybase.configuration.SecureSettingsMixin" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Mixin adding security validations for settings.</p>
<p>Validates:</p>
<ul class="simple">
<li><p>JSON env values don’t exceed 64KB</p></li>
<li><p>Complex types come from validated JSON, not eval()</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MySettings</span><span class="p">(</span><span class="n">SecureSettingsMixin</span><span class="p">,</span> <span class="n">BaseSettings</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="buvis.pybase.configuration.SecureSettingsMixin.validate_json_sizes">
<span class="sig-name descname"><span class="pre">validate_json_sizes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#buvis.pybase.configuration.SecureSettingsMixin.validate_json_sizes" title="Link to this definition"></a></dt>
<dd><p>Check env var sizes before parsing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> – Input data dict from pydantic.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Unmodified data dict if all validations pass.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If any prefixed env var exceeds MAX_JSON_ENV_SIZE.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="click-integration">
<h2>Click Integration<a class="headerlink" href="#click-integration" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="buvis.pybase.configuration.buvis_options">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">buvis_options</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">F</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">F</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.buvis_options" title="Link to this definition"></a></dt>
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">buvis_options</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">settings_class_or_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">settings_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">F</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">F</span><span class="p"><span class="pre">]</span></span></span></span></dt>
<dd><p>Add standard BUVIS options to a Click command.</p>
<p>Adds <code class="docutils literal notranslate"><span class="pre">--debug/--no-debug</span></code>, <code class="docutils literal notranslate"><span class="pre">--log-level</span></code>, <code class="docutils literal notranslate"><span class="pre">--config-dir</span></code>, and
<code class="docutils literal notranslate"><span class="pre">--config</span></code> options. Resolves settings using ConfigResolver and
injects into Click context.
Can be applied as <code class="docutils literal notranslate"><span class="pre">&#64;buvis_options</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;buvis_options()</span></code>, or
<code class="docutils literal notranslate"><span class="pre">&#64;buvis_options(settings_class=CustomSettings)</span></code>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@buvis_options</span><span class="p">(</span><span class="n">settings_class</span><span class="o">=</span><span class="n">GlobalSettings</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">pass_context</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cli</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s2">&quot;Debug mode enabled&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="buvis.pybase.configuration.get_settings">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">get_settings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Context</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#buvis.pybase.configuration.GlobalSettings" title="buvis.pybase.configuration.settings.GlobalSettings"><span class="pre">GlobalSettings</span></a></span></span><a class="headerlink" href="#buvis.pybase.configuration.get_settings" title="Link to this definition"></a></dt>
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">get_settings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">settings_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">T</span></span></span></dt>
<dd><p>Get settings from Click context.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – Click context with settings stored by buvis_options decorator.</p></li>
<li><p><strong>settings_class</strong> – Specific settings class to retrieve from context.
Defaults to GlobalSettings for backward compatibility.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If called before buvis_options decorator ran.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The requested settings instance from context.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Link to this heading"></a></h2>
<dl class="py exception">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigurationError">
<span class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">ConfigurationError</span></span><a class="headerlink" href="#buvis.pybase.configuration.ConfigurationError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Configuration loading or validation failed.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="buvis.pybase.configuration.ConfigurationKeyNotFoundError">
<span class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">ConfigurationKeyNotFoundError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Key</span> <span class="pre">not</span> <span class="pre">found</span> <span class="pre">in</span> <span class="pre">configuration.'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buvis.pybase.configuration.ConfigurationKeyNotFoundError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Key not found in configuration exception.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>message</strong> – Error message describing the missing key.</p>
</dd>
</dl>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="buvis.pybase.configuration.MissingEnvVarError">
<span class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">MissingEnvVarError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buvis.pybase.configuration.MissingEnvVarError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Required env var not set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>var_names</strong> – List of missing environment variable names.</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="buvis.pybase.configuration.MissingEnvVarError.var_names">
<span class="sig-name descname"><span class="pre">var_names</span></span><a class="headerlink" href="#buvis.pybase.configuration.MissingEnvVarError.var_names" title="Link to this definition"></a></dt>
<dd><p>The missing variable names.</p>
</dd></dl>

</dd></dl>

</section>
<section id="validators">
<h2>Validators<a class="headerlink" href="#validators" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="buvis.pybase.configuration.validate_nesting_depth">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">validate_nesting_depth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">BaseModel</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.validate_nesting_depth" title="Link to this definition"></a></dt>
<dd><p>Validate that a model does not exceed the allowed nesting depth.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model_class</strong> – The Pydantic model class to validate.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the model’s nesting depth exceeds <code class="docutils literal notranslate"><span class="pre">MAX_NESTING_DEPTH</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="buvis.pybase.configuration.validate_json_env_size">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">validate_json_env_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">env_var_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.validate_json_env_size" title="Link to this definition"></a></dt>
<dd><p>Validate that an environment variable’s JSON payload fits within limits.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>env_var_name</strong> – The name of the environment variable containing JSON data.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the variable contains more than <code class="docutils literal notranslate"><span class="pre">MAX_JSON_ENV_SIZE</span></code> bytes.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="buvis.pybase.configuration.get_model_depth">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">get_model_depth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">BaseModel</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.get_model_depth" title="Link to this definition"></a></dt>
<dd><p>Calculate the maximum nesting depth of a Pydantic model.</p>
<p>The function traverses nested BaseModel fields to find the deepest path
and short-circuits once the depth exceeds <code class="docutils literal notranslate"><span class="pre">MAX_NESTING_DEPTH</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_class</strong> – The root Pydantic model class to examine.</p></li>
<li><p><strong>current_depth</strong> – The depth of the current model in the recursion tree.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The maximum nesting depth encountered relative to the root model.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="buvis.pybase.configuration.is_sensitive_field">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">is_sensitive_field</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#buvis.pybase.configuration.is_sensitive_field" title="Link to this definition"></a></dt>
<dd><p>Check if field path contains sensitive data indicators.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>field_path</strong> – Dotted field path (e.g., “database.password”).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if any part matches sensitive patterns.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Link to this heading"></a></h2>
<dl class="py data">
<dt class="sig sig-object py" id="buvis.pybase.configuration.MAX_NESTING_DEPTH">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">MAX_NESTING_DEPTH</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">5</span></span><a class="headerlink" href="#buvis.pybase.configuration.MAX_NESTING_DEPTH" title="Link to this definition"></a></dt>
<dd><p>int([x]) -&gt; integer
int(x, base=10) -&gt; integer</p>
<p>Convert a number or string to an integer, or return 0 if no arguments
are given.  If x is a number, return x.__int__().  For floating-point
numbers, this truncates towards zero.</p>
<p>If x is not a number or if base is given, then x must be a string,
bytes, or bytearray instance representing an integer literal in the
given base.  The literal can be preceded by ‘+’ or ‘-’ and be surrounded
by whitespace.  The base defaults to 10.  Valid bases are 0 and 2-36.
Base 0 means to interpret the base from the string as an integer literal.
&gt;&gt;&gt; int(‘0b100’, base=0)
4</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="buvis.pybase.configuration.MAX_JSON_ENV_SIZE">
<span class="sig-prename descclassname"><span class="pre">buvis.pybase.configuration.</span></span><span class="sig-name descname"><span class="pre">MAX_JSON_ENV_SIZE</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">65536</span></span><a class="headerlink" href="#buvis.pybase.configuration.MAX_JSON_ENV_SIZE" title="Link to this definition"></a></dt>
<dd><p>int([x]) -&gt; integer
int(x, base=10) -&gt; integer</p>
<p>Convert a number or string to an integer, or return 0 if no arguments
are given.  If x is a number, return x.__int__().  For floating-point
numbers, this truncates towards zero.</p>
<p>If x is not a number or if base is given, then x must be a string,
bytes, or bytearray instance representing an integer literal in the
given base.  The literal can be preceded by ‘+’ or ‘-’ and be surrounded
by whitespace.  The base defaults to 10.  Valid bases are 0 and 2-36.
Base 0 means to interpret the base from the string as an integer literal.
&gt;&gt;&gt; int(‘0b100’, base=0)
4</p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="buvis-gems Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="formatting.html" class="btn btn-neutral float-right" title="Formatting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2026, Tomáš Bouška.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>